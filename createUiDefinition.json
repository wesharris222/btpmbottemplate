{
  "$schema": "https://schema.management.azure.com/schemas/0.1.2-preview/CreateUIDefinition.MultiVm.json#",
  "handler": "Microsoft.Azure.CreateUIDef",
  "version": "0.1.2-preview",
  "parameters": {
    "config": {
      "isWizard": false,
      "basics": {
        "description": "Deploy an Azure Bot for BeyondTrust approval management. This template will automatically create all required Azure resources and deploy your bot code.",
        "subscription": {
          "constraints": {
            "validations": [
              {
                "permission": "Microsoft.Resources/subscriptions/resourceGroups/read",
                "message": "Must be able to create a resource group"
              }
            ]
          }
        },
        "resourceGroup": {
          "constraints": {
            "validations": [
              {
                "isValid": "[not(contains(basics('resourceGroup').name, 'rg'))]",
                "message": "Resource group name should not contain 'rg'"
              }
            ]
          }
        },
        "location": {
          "label": "Location",
          "toolTip": "Azure region where resources will be deployed",
          "resourceTypes": [
            "Microsoft.Web/sites",
            "Microsoft.BotService/botServices"
          ]
        }
      }
    },
    "basics": [
      {
        "name": "botName",
        "type": "Microsoft.Common.TextBox",
        "label": "Bot Name",
        "placeholder": "MyApprovalBot",
        "toolTip": "Enter a unique name for your bot. This will be used for various Azure resources.",
        "constraints": {
          "required": true,
          "regex": "^[a-zA-Z0-9][a-zA-Z0-9-]{1,62}[a-zA-Z0-9]$",
          "validationMessage": "Bot name must be 3-64 characters long, contain only letters, numbers, and hyphens, and cannot start or end with a hyphen."
        }
      }
    ],
    "steps": [
      {
        "name": "beyondTrustConfig",
        "label": "BeyondTrust Configuration",
        "elements": [
          {
            "name": "beyondTrustSection",
            "type": "Microsoft.Common.Section",
            "label": "BeyondTrust Settings",
            "elements": [
              {
                "name": "beyondTrustBaseUrl",
                "type": "Microsoft.Common.TextBox",
                "label": "BeyondTrust Base URL",
                "placeholder": "https://your-company-services.pm.beyondtrustcloud.com",
                "toolTip": "Enter your BeyondTrust Password Safe base URL",
                "constraints": {
                  "required": true,
                  "regex": "^https://.*\\.pm\\.beyondtrustcloud\\.com$",
                  "validationMessage": "Must be a valid BeyondTrust cloud URL (https://xxx.pm.beyondtrustcloud.com)"
                }
              },
              {
                "name": "beyondTrustClientId",
                "type": "Microsoft.Common.TextBox",
                "label": "BeyondTrust Client ID",
                "placeholder": "your-client-id",
                "toolTip": "Enter your BeyondTrust API Client ID",
                "constraints": {
                  "required": true,
                  "regex": "^.{10,}$",
                  "validationMessage": "Client ID must be at least 10 characters long"
                }
              },
              {
                "name": "beyondTrustClientSecret",
                "type": "Microsoft.Common.PasswordBox",
                "label": {
                  "password": "BeyondTrust Client Secret"
                },
                "toolTip": "Enter your BeyondTrust API Client Secret",
                "constraints": {
                  "required": true,
                  "regex": "^.{10,}$",
                  "validationMessage": "Client secret must be at least 10 characters long"
                },
                "options": {
                  "hideConfirmation": true
                }
              }
            ]
          }
        ]
      },
      {
        "name": "teamsConfig",
        "label": "Teams Configuration",
        "elements": [
          {
            "name": "teamsSection",
            "type": "Microsoft.Common.Section",
            "label": "Microsoft Teams Settings",
            "elements": [
              {
                "name": "teamsChannelName",
                "type": "Microsoft.Common.TextBox",
                "label": "Teams Channel Name",
                "defaultValue": "Bots Mansion",
                "toolTip": "Name of the Teams channel where notifications will be sent",
                "constraints": {
                  "required": true,
                  "regex": "^[a-zA-Z0-9 ._-]{1,50}$",
                  "validationMessage": "Channel name must be 1-50 characters and contain only letters, numbers, spaces, periods, underscores, and hyphens"
                }
              }
            ]
          }
        ]
      },
      {
        "name": "advancedConfig",
        "label": "Advanced Configuration",
        "elements": [
          {
            "name": "gitRepoUrl",
            "type": "Microsoft.Common.TextBox",
            "label": "Git Repository URL",
            "defaultValue": "https://github.com/wesharris222/btpmapprovalsbot",
            "toolTip": "URL to the git repository containing the bot source code",
            "constraints": {
              "required": true,
              "regex": "^https://github\\.com/.+/.+$",
              "validationMessage": "Must be a valid GitHub repository URL"
            }
          }
        ]
      }
    ],
    "outputs": {
      "botName": "[basics('botName')]",
      "location": "[location()]",
      "beyondTrustBaseUrl": "[steps('beyondTrustConfig').beyondTrustSection.beyondTrustBaseUrl]",
      "beyondTrustClientId": "[steps('beyondTrustConfig').beyondTrustSection.beyondTrustClientId]",
      "beyondTrustClientSecret": "[steps('beyondTrustConfig').beyondTrustSection.beyondTrustClientSecret]",
      "teamsChannelName": "[steps('teamsConfig').teamsSection.teamsChannelName]",
      "gitRepoUrl": "[steps('advancedConfig').gitRepoUrl]"
    }
  }
}